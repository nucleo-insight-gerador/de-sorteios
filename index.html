<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Nucleo Insight | System</title>
    <meta name="theme-color" content="#000000">
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/png" href="https://i.ibb.co/nMt8zB1d/LOGO-01.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@500;700&family=JetBrains+Mono:wght@400;800&display=swap" rel="stylesheet">

    <style>
        :root { --primary: #ffd700; --neon-glow: 0 0 10px rgba(255, 215, 0, 0.6); --bg: #050505; --surface: rgba(20, 20, 20, 0.8); }
        * { margin: 0; padding: 0; box-sizing: border-box; user-select: none; -webkit-tap-highlight-color: transparent; }
        
        body { 
            background-color: var(--bg); color: #fff; font-family: 'Rajdhani', sans-serif; 
            height: 100vh; overflow: hidden; display: flex; flex-direction: column;
            background-image: radial-gradient(circle at 50% 10%, #1a1a00 0%, #000 90%);
        }

        #neural-canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 0; opacity: 0.3; pointer-events: none; }

        .marquee-container { 
            background: rgba(0, 255, 136, 0.1); border-bottom: 1px solid rgba(0, 255, 136, 0.2); 
            height: 30px; overflow: hidden; white-space: nowrap; position: relative; z-index: 10; display: flex; align-items: center;
        }
        .marquee-content { 
            display: inline-block; animation: marquee 20s linear infinite; 
            font-family: 'JetBrains Mono', monospace; font-size: 10px; color: #00ff88; text-transform: uppercase;
        }
        @keyframes marquee { 0% { transform: translateX(100vw); } 100% { transform: translateX(-100%); } }

        .z-content { position: relative; z-index: 50; } 
        
        .btn-pulse {
            background: linear-gradient(180deg, #ffd700 0%, #b8860b 100%);
            border: none; color: #000; padding: 20px;
            font-family: 'JetBrains Mono', monospace; font-weight: 800; font-size: 18px;
            text-transform: uppercase; letter-spacing: 2px;
            border-radius: 12px; cursor: pointer; width: 100%;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.4);
            animation: pulse-gold 2s infinite; position: relative; overflow: hidden;
            clip-path: polygon(10px 0, 100% 0, 100% calc(100% - 10px), calc(100% - 10px) 100%, 0 100%, 0 10px);
        }
        .btn-pulse::after {
            content: ''; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.8), transparent);
            transform: rotate(45deg) translateY(-100%); animation: shine 3s infinite;
        }
        @keyframes pulse-gold { 0% { box-shadow: 0 0 0 0 rgba(255, 215, 0, 0.7); transform: scale(1); } 70% { box-shadow: 0 0 0 10px rgba(255, 215, 0, 0); transform: scale(1.02); } 100% { box-shadow: 0 0 0 0 rgba(255, 215, 0, 0); transform: scale(1); } }
        @keyframes shine { 0% { top: -100%; opacity: 0; } 20% { opacity: 1; } 100% { top: 200%; opacity: 0; } }

        .game-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-bottom: 20px; }
        .game-card { 
            background: rgba(255,255,255,0.03); border: 1px solid #333; border-radius: 8px; 
            padding: 12px; text-align: center; cursor: pointer; transition: all 0.2s; position: relative;
        }
        .game-card.active { 
            border-color: var(--primary); background: rgba(255, 215, 0, 0.15); 
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.2); 
        }
        .game-card.active::before { content: '‚óè'; color: var(--primary); position: absolute; top: 5px; right: 5px; font-size: 8px; }

        input[type=range] { -webkit-appearance: none; width: 100%; height: 6px; background: #222; border-radius: 3px; outline: none; } 
        input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; height: 20px; width: 20px; border-radius: 50%; background: #fff; border: 2px solid var(--primary); box-shadow: 0 0 10px var(--primary); cursor: grab; }

        .screen { display: none; flex-direction: column; height: 100%; padding: 20px; position: relative; z-index: 2; }
        .screen.active { display: flex; animation: fadeUp 0.4s ease; }
        @keyframes fadeUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        .matrix-text { color: var(--primary); font-family: 'JetBrains Mono'; font-size: 12px; text-align: center; margin-top: 10px; opacity: 0.8; }
        .spin-container { display: flex; justify-content: center; gap: 5px; font-size: 24px; font-family: 'JetBrains Mono'; color: #fff; margin: 20px 0; }
        .spin-digit { width: 30px; text-align: center; border-bottom: 2px solid #333; }
        .result-grid { display: flex; flex-wrap: wrap; gap: 8px; justify-content: center; margin: 30px 0; perspective: 1000px; }
        .ball { 
            width: 48px; height: 48px; background: linear-gradient(135deg, #222, #000); border: 1px solid #444; color: var(--primary);
            border-radius: 50%; display: flex; align-items: center; justify-content: center; font-family: 'JetBrains Mono'; font-weight: 800; font-size: 18px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.5); opacity: 0; transform: rotateX(90deg); 
        }
        .ball.reveal { animation: flipIn 0.5s forwards cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        @keyframes flipIn { from { opacity: 0; transform: rotateX(90deg) translateY(20px); } to { opacity: 1; transform: rotateX(0) translateY(0); } }

        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 5000; display: none; align-items: center; justify-content: center; backdrop-filter: blur(10px); }
        .modal-box { background: #111; border: 1px solid var(--primary); padding: 30px; border-radius: 16px; width: 90%; max-width: 380px; text-align: center; box-shadow: 0 0 50px rgba(255, 215, 0, 0.15); }
        .input-box { background: #111; border: 1px solid #333; color: #fff; padding: 15px; width: 100%; margin-bottom: 15px; border-radius: 8px; }
        #testModeBar { background: #f00; color: #fff; text-align: center; font-size: 9px; padding: 2px; display: none; z-index: 9999; position: relative; }
        
        .btn-google { 
            background: #fff; color: #000; border: none; border-radius: 8px; padding: 15px; 
            display: flex; align-items: center; justify-content: center; gap: 10px; 
            font-weight: bold; font-size: 14px; cursor: pointer; margin-top: 10px; width: 100%;
            transition: transform 0.2s; position: relative; z-index: 200;
        }
        .btn-google:active { transform: scale(0.95); background: #eee; }
        
        #social-toast {
            position: fixed; top: 20px; left: 50%; transform: translateX(-50%) translateY(-100px);
            background: rgba(20, 20, 20, 0.9); border: 1px solid rgba(255, 215, 0, 0.3);
            padding: 10px 15px; border-radius: 30px; display: flex; align-items: center; gap: 10px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.5); z-index: 2000; transition: transform 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            width: 90%; max-width: 350px; backdrop-filter: blur(5px);
        }
        #social-toast.visible { transform: translateX(-50%) translateY(0); }
        .toast-avatar { width: 24px; height: 24px; background: linear-gradient(45deg, #ffd700, #ffaa00); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; color: #000; font-size: 10px; }
    </style>
</head>
<body>

    <div id="testModeBar">üîß MODO ADMIN</div>
    <canvas id="neural-canvas"></canvas>

    <div class="marquee-container">
        <div class="marquee-content" id="marqueeText">
            üçÄ MARCOS S. ACERTOU 14 PONTOS NA LOTOF√ÅCIL HOJE ‚Ä¢ ü¶Å JULIA P. PEGOU O GRUPO DO URSO ‚Ä¢ üí∞ R$ 1.500,00 PREMIADO PARA ROBERTO K. ‚Ä¢ 
        </div>
    </div>
    
    <div id="social-toast">
        <div class="toast-avatar">N</div>
        <div style="flex:1;">
            <p style="color:#fff; font-size:11px; font-weight:bold; margin-bottom:2px;" id="toast-title">Novo Palpite</p>
            <p style="color:#888; font-size:10px;" id="toast-desc">...</p>
        </div>
        <i data-lucide="check-circle" size="16" class="text-gold"></i>
    </div>

    <div id="paywallModal" class="modal-overlay">
        <div class="modal-box">
            <i data-lucide="lock" size="48" class="text-gold" style="margin-bottom: 20px;"></i>
            <h2 style="color:#fff; font-size:20px; font-weight:800; margin-bottom:10px;">SISTEMA BLOQUEADO</h2>
            <p style="color:#888; font-size:14px; margin-bottom:25px;">Limite atingido. A IA precisa recalibrar ou voc√™ pode liberar acesso total.</p>
            <button onclick="openVipLink()" class="btn-pulse" style="font-size:14px; padding:15px;"><i data-lucide="zap"></i> DESBLOQUEAR TUDO</button>
            <button onclick="closeModal()" style="background:none; border:none; color:#555; margin-top:15px; font-size:12px;">Voltar amanh√£</button>
        </div>
    </div>

    <div id="screen-home" class="screen active z-content" style="justify-content: center; align-items: center; text-align: center;">
        <div style="width:120px; height:120px; margin-bottom:20px; position:relative;">
            <div style="position:absolute; inset:0; border:2px solid var(--primary); border-radius:50%; animation:pulse-gold 2s infinite;"></div>
            <img src="https://i.ibb.co/nMt8zB1d/LOGO-01.png" style="width:100%; height:100%; border-radius:50%; object-fit:cover; position:relative; z-index:2;">
        </div>
        <h1 style="font-size: 32px; font-weight: 800; color: #fff; letter-spacing: 2px;">NUCLEO <span style="color:var(--primary)">INSIGHT</span></h1>
        <p style="color:#666; font-family:'JetBrains Mono'; font-size:10px; margin-top:5px; letter-spacing:4px;">QUANTUM INTELLIGENCE v5.4</p>
        
        <div style="width:100%; max-width:300px; margin-top:40px; position: relative; z-index: 100;">
            <button id="btnLogin" class="btn-google">
                <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" width="18"> 
                ENTRAR COM GOOGLE
            </button>
            <p id="loadingLogin" style="color:#ffd700; font-size:10px; margin-top:10px; display:none;">Conectando...</p>
            <p style="color:#333; font-size:9px; margin-top:15px;">üîí CONEX√ÉO CRIPTOGRAFADA</p>
        </div>
    </div>

    <div id="screen-ritual" class="screen z-content" style="justify-content: flex-start;">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
            <div style="font-family:'JetBrains Mono'; font-size:10px; color:#666;">ID: <span id="userIdDisplay">...</span></div>
            <div style="background:#111; padding:4px 10px; border-radius:20px; border:1px solid #333; font-size:10px; color:var(--primary);">
                CR√âDITOS: <span id="usageCount">...</span>
            </div>
        </div>

        <div style="margin-bottom:20px;">
            <label style="color:#888; font-size:10px; font-weight:bold; letter-spacing:1px; text-transform:uppercase;">PROTOCOLO DE AN√ÅLISE</label>
            <div class="game-grid" style="margin-top:10px;">
                <div class="game-card active" onclick="selectGame('lotofacil', this)"><div style="font-size:24px;">üçÄ</div><div style="font-size:10px; font-weight:bold; margin-top:5px; color:#ccc;">LOTOF√ÅCIL</div></div>
                <div class="game-card" onclick="selectGame('mega', this)"><div style="font-size:24px;">üí∞</div><div style="font-size:10px; font-weight:bold; margin-top:5px; color:#ccc;">MEGA SENA</div></div>
                <div class="game-card" onclick="selectGame('quina', this)"><div style="font-size:24px;">üî∑</div><div style="font-size:10px; font-weight:bold; margin-top:5px; color:#ccc;">QUINA</div></div>
                <div class="game-card" onclick="selectGame('bicho', this)"><div style="font-size:24px;">ü¶Å</div><div style="font-size:10px; font-weight:bold; margin-top:5px; color:#ccc;">PALPITE</div></div>
            </div>
            
            <input type="hidden" id="gameType" value="lotofacil">
            <input type="text" id="dreamInput" class="input-box" placeholder="DIGITE O SONHO..." style="display:none; border-color:var(--primary); background:rgba(255,215,0,0.05); color:var(--primary); font-weight:bold; text-align:center;">
        </div>

        <div style="background:rgba(255,255,255,0.02); padding:15px; border-radius:10px; border:1px solid #222; margin-bottom:20px;">
            <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
                <span style="font-size:10px; color:#666; font-weight:bold;">CALIBRAGEM DE RISCO</span>
                <span id="boldnessValue" style="font-size:12px; font-weight:bold; color:var(--primary);">50%</span>
            </div>
            <input type="range" min="10" max="90" value="50" oninput="updateBoldness(this.value)">
            <div style="display:flex; justify-content:space-between; margin-top:5px; font-size:9px; color:#444;"><span>CONSERVADOR</span><span>OUSADO</span></div>
        </div>

        <div style="margin-top:auto;"><button onclick="checkLimitAndStart()" class="btn-pulse">DECODIFICAR PADR√ÉO</button></div>
    </div>

    <div id="screen-loading" class="screen z-content" style="justify-content:center; align-items:center;">
        <i data-lucide="cpu" size="64" class="text-gold" style="animation:spin 3s linear infinite;"></i>
        <div class="spin-container" id="spinContainer"></div>
        <div id="terminalText" class="matrix-text">INICIALIZANDO NEURAL CORE...</div>
    </div>

    <div id="screen-result" class="screen z-content">
        <div style="display:flex; justify-content:space-between; margin-bottom:30px;">
            <button onclick="resetApp()" style="background:none; border:none; color:#666; display:flex; align-items:center; gap:5px;"><i data-lucide="arrow-left" size="16"></i> NOVO JOGO</button>
            <div style="color:#00ff88; font-size:10px; font-weight:bold; border:1px solid #00ff88; padding:2px 8px; border-radius:4px;">CONCLU√çDO</div>
        </div>
        <div style="text-align:center;">
            <h2 style="font-size:12px; letter-spacing:2px; color:#666; margin-bottom:10px;">SEQU√äNCIA DECODIFICADA</h2>
            <div id="numbersGrid" class="result-grid"></div>
            <div id="animalResult" style="display:none; font-size:24px; color:var(--primary); font-weight:800; text-transform:uppercase; text-shadow:0 0 20px rgba(255,215,0,0.5); margin-bottom:20px;"></div>
        </div>
        <div style="margin-top:auto; padding:20px; background:rgba(255,215,0,0.05); border:1px solid rgba(255,215,0,0.2); border-radius:12px; position:relative; overflow:hidden;">
            <div style="position:absolute; top:0; left:0; width:100%; height:2px; background:var(--primary); box-shadow:0 0 10px var(--primary);"></div>
            <p style="font-size:10px; color:#888; font-weight:bold; margin-bottom:5px;">AN√ÅLISE DE PROBABILIDADE:</p>
            <p id="logText" style="font-size:11px; color:#ccc; line-height:1.4;">...</p>
            <p id="apiStatus" style="font-size:9px; color:#444; margin-top:10px;"></p>
        </div>
        <div style="margin-top:20px;">
            <button onclick="openVipLink()" class="btn-pulse" style="font-size:14px; padding:15px; animation:none; border:1px solid var(--primary);"><i data-lucide="crown"></i> QUERO ACESSO VITAL√çCIO</button>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged, setPersistence, browserLocalPersistence } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, serverTimestamp, doc, getDoc, setDoc, updateDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        import { getAnalytics, logEvent } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-analytics.js";

        // CONFIGURA√á√ÉO ORIGINAL
        const firebaseConfig = { apiKey: "AIzaSyCga2CVSKysTYUpY3RDZNyV5BXhJe32lJQ", authDomain: "nucleo-insight-gerador.firebaseapp.com", projectId: "nucleo-insight-gerador", storageBucket: "nucleo-insight-gerador.firebasestorage.app", messagingSenderId: "159624822756", appId: "1:159624822756:web:279e5e1d4e0b80bc4991f1" };
        
        const app = initializeApp(firebaseConfig); const auth = getAuth(app); const db = getFirestore(app); const analytics = getAnalytics(app); const provider = new GoogleAuthProvider();
        
        let currentUser = null; let currentNumbers = []; let currentMode = 'lotofacil'; let currentBoldness = 50; let userUsage = 0; let isVip = false;
        
        if(sessionStorage.getItem('isTest') === 'true') { document.getElementById('testModeBar').style.display = 'block'; }
        const urlParams = new URLSearchParams(window.location.search);
        const isTestURL = urlParams.get('mode') === 'test';
        if(isTestURL) { sessionStorage.setItem('isTest', 'true'); document.getElementById('testModeBar').style.display = 'block'; }
        const isTestMode = sessionStorage.getItem('isTest') === 'true';
        const DAILY_LIMIT = 5;

        // --- BACKGROUND CANVAS ---
        const canvas = document.getElementById('neural-canvas'); const ctx = canvas.getContext('2d');
        let width, height, particles = [];
        function resize() { width = canvas.width = window.innerWidth; height = canvas.height = window.innerHeight; }
        class Particle { constructor() { this.x = Math.random()*width; this.y = Math.random()*height; this.vx = (Math.random()-0.5)*0.5; this.vy = (Math.random()-0.5)*0.5; this.size = Math.random()*2; } update() { this.x += this.vx; this.y += this.vy; if(this.x<0||this.x>width) this.vx*=-1; if(this.y<0||this.y>height) this.vy*=-1; } draw() { ctx.fillStyle = 'rgba(255, 215, 0, 0.3)'; ctx.beginPath(); ctx.arc(this.x, this.y, this.size, 0, Math.PI*2); ctx.fill(); } }
        function initParticles() { particles = []; for(let i=0; i<50; i++) particles.push(new Particle()); }
        function animateParticles() { ctx.clearRect(0,0,width,height); particles.forEach(p => { p.update(); p.draw(); }); for(let i=0; i<particles.length; i++) { for(let j=i; j<particles.length; j++) { let dx = particles[i].x - particles[j].x; let dy = particles[i].y - particles[j].y; let dist = Math.sqrt(dx*dx + dy*dy); if(dist < 100) { ctx.strokeStyle = `rgba(255, 215, 0, ${0.1 - dist/1000})`; ctx.lineWidth = 0.5; ctx.beginPath(); ctx.moveTo(particles[i].x, particles[i].y); ctx.lineTo(particles[j].x, particles[j].y); ctx.stroke(); } } } requestAnimationFrame(animateParticles); }
        window.addEventListener('resize', resize); resize(); initParticles(); animateParticles();

        // --- SOCIAL TOAST ---
        const names = ["Jo√£o M.", "Carlos S.", "Ana P.", "Pedro H.", "Lucas F.", "Mariana L.", "Fernanda K."];
        const actions = ["Lotof√°cil", "Mega Sena", "Quina", "Bicho"];
        setInterval(() => {
            if(Math.random() > 0.5) {
                const toast = document.getElementById('social-toast');
                const name = names[Math.floor(Math.random() * names.length)];
                const action = actions[Math.floor(Math.random() * actions.length)];
                document.querySelector('.toast-avatar').innerText = name[0];
                document.getElementById('toast-title').innerText = "Novo Palpite Gerado";
                document.getElementById('toast-desc').innerText = `${name} gerou um jogo na ${action}`;
                toast.classList.add('visible');
                setTimeout(() => toast.classList.remove('visible'), 4000);
            }
        }, 15000);

        window.selectGame = (mode, el) => { currentMode = mode; document.getElementById('gameType').value = mode; document.querySelectorAll('.game-card').forEach(c => c.classList.remove('active')); el.classList.add('active'); const inp = document.getElementById('dreamInput'); if(mode === 'bicho') { inp.style.display = 'block'; inp.focus(); } else { inp.style.display = 'none'; } }
        window.updateBoldness = (val) => { currentBoldness = val; document.getElementById('boldnessValue').innerText = val + '%'; const root = document.documentElement; if(val < 35) root.style.setProperty('--current-color', '#00ff88'); else if(val < 70) root.style.setProperty('--current-color', '#ffd700'); else root.style.setProperty('--current-color', '#ff0055'); }

        async function fetchRealLotteryData(mode) { const map = {'lotofacil': 'lotofacil', 'mega': 'megasena', 'quina': 'quina'}; if(!map[mode]) return null; try { const r = await fetch(`https://loteriascaixa-api.herokuapp.com/api/${map[mode]}`); if(!r.ok) throw Error(); return await r.json(); } catch(e) { return null; } }
        function getDailySeed() { const d = new Date(); return d.getFullYear()*10000 + (d.getMonth()+1)*100 + d.getDate(); }
        function seededRandom(s) { var x = Math.sin(s++) * 10000; return x - Math.floor(x); }

        async function checkServerUsage() { if (!currentUser) return; const today = new Date().toDateString(); const ref = doc(db, "usage", currentUser.uid); try { const snap = await getDoc(ref); if(snap.exists()) { const d = snap.data(); if(d.date===today) userUsage=d.count; else { userUsage=0; await setDoc(ref,{date:today,count:0,email:currentUser.email},{merge:true}); } if(d.isVip) isVip=true; } else { userUsage=0; await setDoc(ref,{date:today,count:0,email:currentUser.email,isVip:false}); } updateUI(); } catch(e){} }
        async function increment() { if(!currentUser || isVip || isTestMode) return; const today=new Date().toDateString(); const ref=doc(db,"usage",currentUser.uid); userUsage++; await updateDoc(ref,{count:userUsage,date:today}); updateUI(); }
        function updateUI() { const d = document.getElementById('usageCount'); if(isTestMode) { d.innerText = "‚àû (TEST)"; d.style.color = "#4488ff"; } else if(isVip) { d.innerText = "ILIMITADO"; d.style.color = "#00ff88"; } else { d.innerText = `${userUsage} / ${DAILY_LIMIT}`; d.style.color = userUsage>=DAILY_LIMIT?"#ff4444":"#ffd700"; } }
        window.checkLimitAndStart = async () => { if(!isTestMode && !isVip && userUsage >= DAILY_LIMIT) { document.getElementById('paywallModal').style.display = 'flex'; return; } startProcessing(); }

        // --- LOGIN FORCE FIX (V5.4) ---
        const btnLogin = document.getElementById('btnLogin');
        const loadingLogin = document.getElementById('loadingLogin');
        
        btnLogin.addEventListener('click', async () => {
            loadingLogin.style.display = 'block';
            try {
                // FOR√áA PERSISTENCIA LOCAL (CORRIGE ERRO DE P√ÅGINA RECARREGANDO SEM LOGIN)
                await setPersistence(auth, browserLocalPersistence);
                // USA POPUP (MAIS EST√ÅVEL QUE REDIRECT EM DISPOSITIVOS M√ìVEIS/WEBAPPS)
                await signInWithPopup(auth, provider);
            } catch (error) {
                loadingLogin.style.display = 'none';
                // ALERTA DE ERRO PARA DEBUG
                alert("ERRO AO LOGAR: " + error.code + "\n" + error.message);
            }
        });

        onAuthStateChanged(auth, (user) => { if(user) { currentUser=user; if(!isTestMode) logEvent(analytics,'login'); document.getElementById('userInfo').innerText="FREE"; document.getElementById('userIdDisplay').innerText = user.email.split('@')[0]; showScreen('screen-ritual'); checkServerUsage(); } else { showScreen('screen-home'); } });

        const dreamDictionary = {'avestruz':1,'ovo':1,'aguia':2,'voar':2,'burro':3,'borboleta':4,'cachorro':5,'cabra':6,'carneiro':7,'camelo':8,'cobra':9,'coelho':10,'cavalo':11,'elefante':12,'galo':13,'gato':14,'jacare':15,'leao':16,'macaco':17,'porco':18,'pavao':19,'peru':20,'touro':21,'tigre':22,'urso':23,'veado':24,'vaca':25};
        const animals = ["","Avestruz","√Åguia","Burro","Borboleta","Cachorro","Cabra","Carneiro","Camelo","Cobra","Coelho","Cavalo","Elefante","Galo","Gato","Jacar√©","Le√£o","Macaco","Porco","Pav√£o","Peru","Touro","Tigre","Urso","Veado","Vaca"];

        window.startProcessing = () => {
            showScreen('screen-loading'); 
            const term = document.getElementById('terminalText');
            const msgs = ["INJETANDO C√ìDIGO...", "ACESSANDO CAIXA_GOV_BR...", "VARRENDO PADR√ïES...", "CALIBRANDO ALGORITMO..."];
            let step = 0;
            const spin = document.getElementById('spinContainer');
            const spinInterval = setInterval(() => {
                spin.innerHTML = '';
                for(let i=0; i<6; i++) { const d = document.createElement('div'); d.className = 'spin-digit'; d.innerText = Math.floor(Math.random()*10); d.style.opacity = Math.random(); spin.appendChild(d); }
                if(step < msgs.length && Math.random() > 0.8) { term.innerText = msgs[step++]; }
            }, 80);
            setTimeout(() => { clearInterval(spinInterval); generateResult(); }, 3500); 
        }

        async function generateResult() {
            await increment();
            currentMode = document.getElementById('gameType').value; 
            const grid = document.getElementById('numbersGrid'); const animalRes = document.getElementById('animalResult'); const logText = document.getElementById('logText'); const apiStatus = document.getElementById('apiStatus');
            grid.innerHTML = ''; animalRes.style.display = 'none'; currentNumbers = [];
            let seed = getDailySeed(); let isSafeMode = currentBoldness < 40; let realData = null;
            if(isSafeMode && (currentMode==='lotofacil'||currentMode==='mega')) realData = await fetchRealLotteryData(currentMode);

            if (currentMode === 'bicho') {
                const inp = document.getElementById('dreamInput').value.toLowerCase().trim(); let group = 0; let key = "";
                for (const [k, v] of Object.entries(dreamDictionary)) { if (inp.includes(k)) { group = v; key=k; break; } }
                if (group === 0 && inp.length > 0) { let h=0; for(let i=0;i<inp.length;i++) h+=inp.charCodeAt(i); group=(h%25)+1; key="Vibra√ß√£o"; }
                if (group === 0) { group = Math.floor(Math.random()*25)+1; key="Aleat√≥rio"; }
                let base = (group-1)*4+1; currentNumbers=[base,base+1,base+2,base+3];
                animalRes.innerText = `ü¶Å ${animals[group]} (G${group})`; animalRes.style.display='block';
                logText.innerText = `Decodifica√ß√£o: ${key.toUpperCase()}`; apiStatus.innerText = "Dicion√°rio On√≠rico v2.1";
                renderBalls(currentNumbers);
            } else {
                let max=25, count=15; if (currentMode==='mega'){max=60;count=6;} if (currentMode==='quina'){max=80;count=5;}
                let nums = new Set();
                if(isSafeMode) {
                    if(realData) { let last = realData.dezenas.map(d=>parseInt(d)); for(let i=0; i<Math.floor(count/2); i++) nums.add(last[i]); logText.innerText = `Base: Concurso ${realData.numero}`; apiStatus.innerText = "FONTE: CAIXA ECON√îMICA FEDERAL"; } else { logText.innerText = "Base: Hist√≥rico Estat√≠stico"; apiStatus.innerText = "FONTE: DATABASE INTERNA"; }
                    while(nums.size < count) nums.add(Math.floor(seededRandom(seed++) * max) + 1);
                } else { while(nums.size < count) nums.add(Math.floor(Math.random() * max) + 1); logText.innerText = "Estrat√©gia: Quebra de Padr√£o (Caos)"; apiStatus.innerText = "FONTE: ENTROPIA PURA"; }
                currentNumbers = Array.from(nums).sort((a,b)=>a-b);
                renderBalls(currentNumbers);
            }
            if(currentUser) { await addDoc(collection(db, "history"), { uid: currentUser.uid, email: currentUser.email, numbers: currentNumbers, mode: currentMode, isTest: isTestMode, createdAt: serverTimestamp() }); }
            showScreen('screen-result');
        }

        function renderBalls(numbers) {
            const grid = document.getElementById('numbersGrid');
            numbers.forEach((n, i) => {
                const div = document.createElement('div'); div.className = 'ball'; div.innerText = n < 10 ? '0'+n : n;
                div.style.animationDelay = (i * 0.1) + 's'; setTimeout(() => div.classList.add('reveal'), 100); grid.appendChild(div);
            });
        }

        window.openVipLink = () => { if(isTestMode) return alert("Modo Teste."); window.open("https://pay.kiwify.com.br/MuUU7j8", "_blank"); }
        window.closeModal = () => { document.getElementById('paywallModal').style.display = 'none'; }
        window.resetApp = () => showScreen('screen-ritual');
        function showScreen(id) { document.querySelectorAll('.screen').forEach(s => s.classList.remove('active')); document.getElementById(id).classList.add('active'); }
        lucide.createIcons();
    </script>
</body>
</html>
