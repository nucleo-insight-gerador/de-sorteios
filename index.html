<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Nucleo Insight | System</title>
    <meta name="theme-color" content="#000000">
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/png" href="https://i.ibb.co/nMt8zB1d/LOGO-01.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@500;700&family=JetBrains+Mono:wght@400;800&display=swap" rel="stylesheet">

    <style>
        :root { --primary: #ffd700; --bg: #050505; --surface: #121212; }
        * { margin: 0; padding: 0; box-sizing: border-box; user-select: none; -webkit-tap-highlight-color: transparent; }
        
        body { 
            background-color: var(--bg); color: #fff; font-family: 'Rajdhani', sans-serif; 
            height: 100vh; overflow: hidden; display: flex; flex-direction: column;
            background-image: radial-gradient(circle at 50% 10%, #1a1a00 0%, #000 90%);
        }

        #neural-canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 0; opacity: 0.4; pointer-events: none; }
        .z-content { position: relative; z-index: 50; } 

        ::-webkit-scrollbar { width: 0px; background: transparent; }

        .marquee-container { 
            background: rgba(0, 255, 136, 0.1); border-bottom: 1px solid rgba(0, 255, 136, 0.2); 
            height: 28px; overflow: hidden; white-space: nowrap; position: relative; z-index: 10; display: flex; align-items: center;
        }
        .marquee-content { 
            display: inline-block; animation: marquee 25s linear infinite; 
            font-family: 'JetBrains Mono', monospace; font-size: 9px; color: #00ff88; text-transform: uppercase; font-weight: bold;
        }
        @keyframes marquee { 0% { transform: translateX(100vw); } 100% { transform: translateX(-100%); } }

        .games-wrapper { overflow-y: auto; max-height: 40vh; padding: 5px; margin-bottom: 10px; }
        .game-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
        
        .game-card { 
            background: linear-gradient(145deg, rgba(30,30,30,0.9), rgba(10,10,10,0.9)); 
            border: 1px solid #333; border-radius: 12px; padding: 12px; 
            text-align: center; cursor: pointer; transition: all 0.1s; position: relative;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        .game-card:active { transform: scale(0.95); border-color: var(--primary); }
        .game-card.active { border-color: var(--primary); background: rgba(255, 215, 0, 0.1); box-shadow: 0 0 15px rgba(255, 215, 0, 0.2) inset; }
        .game-icon { font-size: 22px; margin-bottom: 4px; filter: drop-shadow(0 0 5px rgba(255,255,255,0.3)); }
        .game-title { font-size: 10px; font-weight: 800; color: #ccc; text-transform: uppercase; letter-spacing: 0.5px; }
        .game-card.active .game-title { color: #fff; text-shadow: 0 0 5px var(--primary); }

        .slider-box { background: rgba(20,20,20,0.8); padding: 15px; border-radius: 12px; border: 1px solid #333; margin-bottom: 15px; }
        input[type=range] { -webkit-appearance: none; width: 100%; height: 8px; border-radius: 4px; outline: none; background: linear-gradient(90deg, #00ff88 0%, #ffd700 50%, #ff0055 100%); } 
        input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; height: 22px; width: 22px; border-radius: 50%; background: #fff; border: 3px solid #000; box-shadow: 0 0 10px rgba(255,255,255,0.8); cursor: grab; margin-top: -7px; }
        input[type=range]::-webkit-slider-runnable-track { width: 100%; height: 8px; cursor: pointer; }

        .btn-pulse {
            background: linear-gradient(180deg, #ffd700 0%, #b8860b 100%);
            border: none; color: #000; padding: 18px;
            font-family: 'JetBrains Mono', monospace; font-weight: 900; font-size: 16px;
            text-transform: uppercase; letter-spacing: 1px;
            border-radius: 12px; cursor: pointer; width: 100%;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.4);
            animation: pulse-gold 2s infinite; position: relative; overflow: hidden;
        }
        .btn-pulse::after { content: ''; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%; background: linear-gradient(45deg, transparent, rgba(255,255,255,0.8), transparent); transform: rotate(45deg) translateY(-100%); animation: shine 3s infinite; }
        @keyframes pulse-gold { 0% { box-shadow: 0 0 0 0 rgba(255, 215, 0, 0.7); } 70% { box-shadow: 0 0 0 10px rgba(255, 215, 0, 0); } 100% { box-shadow: 0 0 0 0 rgba(255, 215, 0, 0); } }
        @keyframes shine { 0% { top: -100%; opacity: 0; } 20% { opacity: 1; } 100% { top: 200%; opacity: 0; } }

        .screen { display: none; flex-direction: column; height: 100%; padding: 20px; position: relative; z-index: 2; }
        .screen.active { display: flex; animation: fadeUp 0.3s ease; }
        @keyframes fadeUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .spin-container { display: flex; justify-content: center; gap: 4px; font-size: 28px; font-family: 'JetBrains Mono'; color: #fff; margin: 20px 0; text-shadow: 0 0 10px var(--primary); }
        .spin-digit { width: 30px; text-align: center; border-bottom: 2px solid #333; }

        .result-grid { display: flex; flex-wrap: wrap; gap: 6px; justify-content: center; margin: 20px 0; max-height: 40vh; overflow-y: auto; }
        .ball { 
            width: 42px; height: 42px; background: linear-gradient(135deg, #1a1a1a, #000); border: 1px solid #333; color: var(--primary);
            border-radius: 50%; display: flex; align-items: center; justify-content: center; font-family: 'JetBrains Mono'; font-weight: 800; font-size: 16px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.8); opacity: 0; transform: scale(0);
        }
        .ball.reveal { animation: popIn 0.3s forwards cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        @keyframes popIn { from { opacity: 0; transform: scale(0); } to { opacity: 1; transform: scale(1); } }

        .btn-google { background: #fff; color: #000; border: none; border-radius: 8px; padding: 14px; display: flex; align-items: center; justify-content: center; gap: 10px; font-weight: bold; font-size: 13px; cursor: pointer; width: 100%; margin-top: 15px; }
        .input-box { background: #111; border: 1px solid #333; color: #fff; padding: 15px; width: 100%; border-radius: 8px; margin-bottom:10px; }
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 5000; display: none; align-items: center; justify-content: center; }
        .modal-box { background: #111; border: 1px solid var(--primary); padding: 30px; border-radius: 16px; width: 85%; max-width: 350px; text-align: center; }
        #testModeBar { background: #ff0000; color: #fff; text-align: center; font-size: 9px; padding: 2px; display: none; z-index: 9999; }
        
        #social-toast {
            position: fixed; top: 40px; left: 50%; transform: translateX(-50%) translateY(-150px);
            background: rgba(10, 10, 10, 0.95); border: 1px solid #333; border-left: 3px solid var(--primary);
            padding: 8px 15px; border-radius: 8px; display: flex; align-items: center; gap: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.8); z-index: 2000; transition: transform 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
            width: 90%; max-width: 320px;
        }
        #social-toast.visible { transform: translateX(-50%) translateY(0); }
        .fallback-link { color: #555; font-size: 10px; text-decoration: underline; margin-top: 15px; cursor: pointer; display: block; }
    </style>
</head>
<body>

    <div id="testModeBar">üîß MODO ADMIN</div>
    <canvas id="neural-canvas"></canvas>

    <div class="marquee-container">
        <div class="marquee-content">
            üí∞ R$ 2.300,00 RETIRADO POR CARLOS M. ‚Ä¢ üçÄ ANA J. FEZ 14 PONTOS AGORA ‚Ä¢ ü¶Å GRUPO DO LE√ÉO SAIU NO RIO ‚Ä¢ üíé M√âTODO V6.0 ATIVO ‚Ä¢ üí∞ R$ 2.300,00 RETIRADO POR CARLOS M. ‚Ä¢ üçÄ ANA J. FEZ 14 PONTOS AGORA
        </div>
    </div>
    
    <div id="social-toast">
        <div style="background:var(--primary); width:8px; height:8px; border-radius:50%; box-shadow:0 0 10px var(--primary);"></div>
        <div style="flex:1;">
            <p style="color:#fff; font-size:10px; font-weight:bold; text-transform:uppercase;">Alerta do Sistema</p>
            <p style="color:#888; font-size:9px;" id="toast-desc">...</p>
        </div>
    </div>

    <div id="paywallModal" class="modal-overlay">
        <div class="modal-box">
            <i data-lucide="lock" size="40" class="text-gold" style="margin-bottom: 15px;"></i>
            <h2 style="color:#fff; font-size:18px; margin-bottom:5px; font-weight:800;">LIMITE ATINGIDO</h2>
            <p style="color:#888; font-size:12px; margin-bottom:20px;">Sua cota gratuita di√°ria encerrou.</p>
            <button onclick="openVipLink()" class="btn-pulse" style="font-size:13px; padding:12px;">LIBERAR TUDO AGORA</button>
            <button onclick="closeModal()" style="background:none; border:none; color:#444; margin-top:15px; font-size:10px;">Voltar amanh√£</button>
        </div>
    </div>

    <div id="screen-home" class="screen active z-content" style="justify-content: center; align-items: center; text-align: center;">
        <div style="position:relative; margin-bottom:30px;">
            <div style="position:absolute; inset:-10px; border:1px solid var(--primary); border-radius:50%; animation:pulse 2s infinite; opacity:0.5;"></div>
            <img src="https://i.ibb.co/nMt8zB1d/LOGO-01.png" style="width:110px; height:110px; border-radius:50%; object-fit:cover; border:3px solid #000; position:relative; z-index:2;">
        </div>
        <h1 style="font-size: 28px; font-weight: 900; color: #fff; letter-spacing: 2px; text-transform: uppercase;">Nucleo <span style="color:var(--primary)">Insight</span></h1>
        <p style="color:#666; font-family:'JetBrains Mono'; font-size:10px; margin-top:5px; letter-spacing:3px;">SYSTEM v6.2 ‚Ä¢ SONIC EDITION</p>
        
        <div style="width:100%; max-width:280px; margin-top:40px;">
            <button id="btnLogin" class="btn-google" onclick="playSound('click')">
                <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" width="18"> 
                ACESSAR SISTEMA
            </button>
            <p id="loadingLogin" style="color:#ffd700; font-size:10px; margin-top:10px; display:none;">Conectando...</p>
            <a onclick="forceRedirectLogin()" class="fallback-link">Problemas no celular? Clique aqui</a>
            <p style="color:#333; font-size:9px; margin-top:15px;">üîí AMBIENTE CRIPTOGRAFADO</p>
        </div>
    </div>

    <div id="screen-ritual" class="screen z-content" style="justify-content: flex-start;">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
            <div style="font-family:'JetBrains Mono'; font-size:10px; color:#666;">ID: <span id="userIdDisplay" style="color:#fff;">...</span></div>
            <div style="background:#111; padding:3px 10px; border-radius:4px; border:1px solid #333; font-size:10px; color:var(--primary);">
                CRED: <span id="usageCount">...</span>
            </div>
        </div>

        <div style="margin-bottom:15px;">
            <label style="color:#888; font-size:10px; font-weight:bold; letter-spacing:1px; text-transform:uppercase; margin-bottom:5px; display:block;">SELECIONE A OPERA√á√ÉO</label>
            <div class="games-wrapper">
                <div class="game-grid">
                    <div class="game-card active" onclick="selectGame('lotofacil', this)"><div class="game-icon">üçÄ</div><div class="game-title">Lotof√°cil</div></div>
                    <div class="game-card" onclick="selectGame('mega', this)"><div class="game-icon">üí∞</div><div class="game-title">Mega Sena</div></div>
                    <div class="game-card" onclick="selectGame('quina', this)"><div class="game-icon">üî∑</div><div class="game-title">Quina</div></div>
                    <div class="game-card" onclick="selectGame('bicho', this)"><div class="game-icon">ü¶Å</div><div class="game-title">Palpite Bicho</div></div>
                    <div class="game-card" onclick="selectGame('lotomania', this)"><div class="game-icon">üé±</div><div class="game-title">Lotomania</div></div>
                    <div class="game-card" onclick="selectGame('timemania', this)"><div class="game-icon">‚öΩ</div><div class="game-title">Timemania</div></div>
                    <div class="game-card" onclick="selectGame('diadesorte', this)"><div class="game-icon">üìÖ</div><div class="game-title">Dia de Sorte</div></div>
                    <div class="game-card" onclick="selectGame('duplasena', this)"><div class="game-icon">üé≤</div><div class="game-title">Dupla Sena</div></div>
                </div>
            </div>
            <input type="hidden" id="gameType" value="lotofacil">
            <input type="text" id="dreamInput" class="input-box" placeholder="Descreva o sonho aqui..." style="display:none; text-align:center; border-color:var(--primary); color:var(--primary); font-weight:bold;">
        </div>

        <div class="slider-box">
            <div style="display:flex; justify-content:space-between; margin-bottom:8px;">
                <span style="font-size:10px; color:#888; font-weight:bold;">TERM√îMETRO DA SORTE</span>
                <span id="boldnessValue" style="font-size:12px; font-weight:bold; color:#fff;">50%</span>
            </div>
            <input type="range" min="10" max="90" value="50" oninput="updateBoldness(this.value)">
            <div style="display:flex; justify-content:space-between; margin-top:5px; font-size:8px; color:#555;"><span>SEGURAN√áA</span><span>RISCO M√ÅXIMO</span></div>
        </div>

        <div style="margin-top:auto;"><button onclick="checkLimitAndStart()" class="btn-pulse">GERAR SINAL DE ALTA PRECIS√ÉO</button></div>
    </div>

    <div id="screen-loading" class="screen z-content" style="justify-content:center; align-items:center;">
        <i data-lucide="cpu" size="64" class="text-gold" style="animation:spin 3s linear infinite;"></i>
        <div class="spin-container" id="spinContainer"></div>
        <div id="terminalText" class="matrix-text">CONECTANDO SAT√âLITE...</div>
    </div>

    <div id="screen-result" class="screen z-content">
        <div style="display:flex; justify-content:space-between; margin-bottom:20px;">
            <button onclick="resetApp()" style="background:none; border:none; color:#666; display:flex; align-items:center; gap:5px; font-size:12px;"><i data-lucide="refresh-ccw" size="14"></i> GERAR OUTRO</button>
            <div style="color:#00ff88; font-size:10px; font-weight:bold; border:1px solid #00ff88; padding:2px 8px; border-radius:4px;">SINAL CONFIRMADO</div>
        </div>
        <div style="text-align:center;">
            <h2 style="font-size:12px; letter-spacing:2px; color:#666; margin-bottom:10px; text-transform:uppercase;">Matriz Vencedora</h2>
            <div id="numbersGrid" class="result-grid"></div>
            <div id="animalResult" style="display:none; font-size:24px; color:var(--primary); font-weight:900; text-transform:uppercase; text-shadow:0 0 20px rgba(255,215,0,0.5); margin-bottom:20px;"></div>
        </div>
        <div style="margin-top:auto; padding:15px; background:rgba(255,215,0,0.05); border:1px solid rgba(255,215,0,0.2); border-radius:8px;">
            <div style="display:flex; align-items:center; gap:8px; margin-bottom:5px;">
                <i data-lucide="bar-chart-2" size="14" class="text-gold"></i>
                <span style="font-size:10px; color:#888; font-weight:bold;">ESTAT√çSTICA DO JOGO:</span>
            </div>
            <p id="logText" style="font-size:11px; color:#fff; line-height:1.4;">...</p>
            <p id="apiStatus" style="font-size:9px; color:#444; margin-top:5px;"></p>
        </div>
        <div style="margin-top:15px;">
            <button onclick="openVipLink()" class="btn-pulse" style="font-size:14px; padding:15px; animation:none; border:1px solid var(--primary); background:#000; color:var(--primary);"><i data-lucide="crown"></i> QUERO ACESSO VITAL√çCIO</button>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, signInWithPopup, signInWithRedirect, getRedirectResult, GoogleAuthProvider, onAuthStateChanged, setPersistence, browserLocalPersistence } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, serverTimestamp, doc, getDoc, setDoc, updateDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        import { getAnalytics, logEvent } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-analytics.js";

        const firebaseConfig = { apiKey: "AIzaSyCga2CVSKysTYUpY3RDZNyV5BXhJe32lJQ", authDomain: "nucleo-insight-gerador.firebaseapp.com", projectId: "nucleo-insight-gerador", storageBucket: "nucleo-insight-gerador.firebasestorage.app", messagingSenderId: "159624822756", appId: "1:159624822756:web:279e5e1d4e0b80bc4991f1" };
        const app = initializeApp(firebaseConfig); const auth = getAuth(app); const db = getFirestore(app); const analytics = getAnalytics(app); const provider = new GoogleAuthProvider();
        
        let currentUser = null; let currentNumbers = []; let currentMode = 'lotofacil'; let currentBoldness = 50; let userUsage = 0; let isVip = false;
        const isTestMode = window.location.search.includes('mode=test');
        const DAILY_LIMIT = 5;

        // --- AUDIO ENGINE (NOVOS SONS) ---
        const sfx = {
            click: new Audio("https://assets.mixkit.co/active_storage/sfx/2571/2571-preview.mp3"), // Tech Click
            win: new Audio("https://assets.mixkit.co/active_storage/sfx/2019/2019-preview.mp3"),   // Coin/Win
            lock: new Audio("https://assets.mixkit.co/active_storage/sfx/2572/2572-preview.mp3")   // Error
        };
        // Ajuste de volume
        sfx.click.volume = 0.4; sfx.win.volume = 0.6; sfx.lock.volume = 0.5;

        window.playSound = (type) => {
            try {
                if(sfx[type]) {
                    sfx[type].currentTime = 0;
                    sfx[type].play().catch(e => console.log("Audio blocked until interaction"));
                }
            } catch(e) {}
        }

        // --- BACKGROUND ---
        const canvas = document.getElementById('neural-canvas'); const ctx = canvas.getContext('2d');
        let width, height, particles = [];
        function resize() { width = canvas.width = window.innerWidth; height = canvas.height = window.innerHeight; }
        class Particle { constructor() { this.x = Math.random()*width; this.y = Math.random()*height; this.vx = (Math.random()-0.5)*0.5; this.vy = (Math.random()-0.5)*0.5; } update() { this.x += this.vx; this.y += this.vy; if(this.x<0||this.x>width) this.vx*=-1; if(this.y<0||this.y>height) this.vy*=-1; } draw() { ctx.fillStyle = 'rgba(255, 215, 0, 0.2)'; ctx.fillRect(this.x, this.y, 2, 2); } }
        function initParticles() { particles = []; for(let i=0; i<40; i++) particles.push(new Particle()); }
        function animate() { ctx.clearRect(0,0,width,height); particles.forEach(p => { p.update(); p.draw(); }); requestAnimationFrame(animate); }
        window.addEventListener('resize', resize); resize(); initParticles(); animate();

        const names = ["Jo√£o M.", "Carlos S.", "Ana P.", "Pedro H.", "Lucas F."];
        const actions = ["Lotof√°cil", "Mega Sena", "Quina", "Bicho"];
        setInterval(() => { if(Math.random()>0.5) { 
            const t = document.getElementById('social-toast'); 
            const n = names[Math.floor(Math.random()*names.length)];
            const a = actions[Math.floor(Math.random()*actions.length)];
            document.getElementById('toast-desc').innerText = `${n} gerou um sinal na ${a}`;
            t.classList.add('visible'); setTimeout(() => t.classList.remove('visible'), 4000);
        }}, 10000);

        // --- GAME LOGIC ---
        window.selectGame = (mode, el) => {
            playSound('click'); // Som
            currentMode = mode; document.getElementById('gameType').value = mode;
            document.querySelectorAll('.game-card').forEach(c => c.classList.remove('active')); el.classList.add('active');
            const inp = document.getElementById('dreamInput');
            inp.style.display = (mode === 'bicho') ? 'block' : 'none';
        }

        window.updateBoldness = (val) => { currentBoldness = val; document.getElementById('boldnessValue').innerText = val + '%'; }

        async function fetchRealLotteryData(mode) {
            const map = {'lotofacil':'lotofacil', 'mega':'megasena', 'quina':'quina', 'timemania':'timemania', 'lotomania':'lotomania', 'diadesorte':'diadesorte', 'duplasena':'duplasena'};
            if(!map[mode]) return null;
            try { const r = await fetch(`https://loteriascaixa-api.herokuapp.com/api/${map[mode]}`); return r.ok ? await r.json() : null; } catch(e) { return null; }
        }

        function getDailySeed() { const d = new Date(); return d.getFullYear()*10000 + (d.getMonth()+1)*100 + d.getDate(); }
        function seededRandom(s) { var x = Math.sin(s++) * 10000; return x - Math.floor(x); }

        document.getElementById('btnLogin').addEventListener('click', async () => {
            playSound('click');
            document.getElementById('loadingLogin').style.display = 'block';
            try { await setPersistence(auth, browserLocalPersistence); await signInWithPopup(auth, provider); } 
            catch (error) { console.log("Popup falhou", error); await signInWithRedirect(auth, provider); }
        });
        window.forceRedirectLogin = async () => { document.getElementById('loadingLogin').innerText = "Redirecionando..."; document.getElementById('loadingLogin').style.display = 'block'; await signInWithRedirect(auth, provider); }
        getRedirectResult(auth).then(() => console.log("Redirect OK"));
        onAuthStateChanged(auth, (user) => { if(user) { currentUser=user; if(!isTestMode) logEvent(analytics,'login'); document.getElementById('userIdDisplay').innerText=user.email.split('@')[0]; showScreen('screen-ritual'); checkServerUsage(); } else { showScreen('screen-home'); } });

        async function checkServerUsage() { if(!currentUser) return; const t=new Date().toDateString(); const ref=doc(db,"usage",currentUser.uid); try{const s=await getDoc(ref); if(s.exists()){const d=s.data(); if(d.date===t) userUsage=d.count; else {userUsage=0; await setDoc(ref,{date:t,count:0,email:currentUser.email},{merge:true});} if(d.isVip) isVip=true;} else {userUsage=0; await setDoc(ref,{date:t,count:0,email:currentUser.email,isVip:false});} updateUI();}catch(e){} }
        async function increment() { if(!currentUser || isVip || isTestMode) return; const t=new Date().toDateString(); const ref=doc(db,"usage",currentUser.uid); userUsage++; await updateDoc(ref,{count:userUsage,date:t}); updateUI(); }
        function updateUI() { const d=document.getElementById('usageCount'); if(isTestMode){d.innerText="TEST";d.style.color="#4488ff";} else if(isVip){d.innerText="VIP";d.style.color="#00ff88";} else {d.innerText=`${userUsage}/5`;d.style.color=userUsage>=DAILY_LIMIT?"#ff4444":"#ffd700";} }
        
        window.checkLimitAndStart = async () => { 
            playSound('click');
            if(!isTestMode && !isVip && userUsage >= DAILY_LIMIT) { 
                playSound('lock'); // Som de bloqueio
                document.getElementById('paywallModal').style.display = 'flex'; return; 
            } 
            startProcessing(); 
        }

        window.startProcessing = () => {
            showScreen('screen-loading');
            const term = document.getElementById('terminalText');
            const msgs = ["ANALISANDO PADR√ïES...", "VARRENDO BANCO DE DADOS...", "CALCULANDO PROBABILIDADE...", "GERANDO SINAL..."];
            let step = 0;
            const spin = document.getElementById('spinContainer');
            const interval = setInterval(() => {
                spin.innerHTML = '';
                for(let i=0; i<6; i++) { const d = document.createElement('div'); d.className='spin-digit'; d.innerText=Math.floor(Math.random()*10); d.style.opacity=Math.random(); spin.appendChild(d); }
                if(step<msgs.length && Math.random()>0.85) term.innerText=msgs[step++];
            }, 80);
            setTimeout(() => { clearInterval(interval); generateResult(); }, 3000);
        }

        async function generateResult() {
            await increment();
            const grid = document.getElementById('numbersGrid'); const animalRes = document.getElementById('animalResult'); const logText = document.getElementById('logText'); const apiStatus = document.getElementById('apiStatus');
            grid.innerHTML = ''; animalRes.style.display = 'none'; currentNumbers = [];
            
            let seed = getDailySeed(); let isSafe = currentBoldness < 40; let realData = null;
            if(isSafe && currentMode!=='bicho') realData = await fetchRealLotteryData(currentMode);

            if (currentMode === 'bicho') {
                const animals = ["","Avestruz","√Åguia","Burro","Borboleta","Cachorro","Cabra","Carneiro","Camelo","Cobra","Coelho","Cavalo","Elefante","Galo","Gato","Jacar√©","Le√£o","Macaco","Porco","Pav√£o","Peru","Touro","Tigre","Urso","Veado","Vaca"];
                const group = Math.floor(Math.random()*25)+1;
                const base = (group-1)*4+1; currentNumbers=[base,base+1,base+2,base+3];
                animalRes.innerText = `ü¶Å ${animals[group]} (G${group})`; animalRes.style.display='block';
                logText.innerText = "Padr√£o Identificado: Algoritmo On√≠rico"; apiStatus.innerText = "FONTE: DICION√ÅRIO GLOBAL";
                renderBalls(currentNumbers);
            } else {
                let max=25, count=15; 
                if(currentMode==='mega' || currentMode==='duplasena'){max=60;count=6;} 
                if(currentMode==='quina'){max=80;count=5;}
                if(currentMode==='timemania'){max=80;count=10;}
                if(currentMode==='lotomania'){max=99;count=20;}
                if(currentMode==='diadesorte'){max=31;count=7;}

                let nums = new Set();
                if(isSafe && realData) {
                    let last = realData.dezenas.map(d=>parseInt(d));
                    for(let i=0; i<Math.min(last.length, Math.floor(count/2)); i++) nums.add(last[i]);
                    logText.innerText = `Base: Concurso ${realData.numero}`; apiStatus.innerText = "FONTE: CAIXA (API OFICIAL)";
                } else {
                    logText.innerText = "Estrat√©gia: Quebra de Padr√£o (Caos)"; apiStatus.innerText = "FONTE: IA GENERATIVA";
                }
                while(nums.size < count) nums.add(Math.floor(seededRandom(seed++) * max) + 1);
                currentNumbers = Array.from(nums).sort((a,b)=>a-b);
                renderBalls(currentNumbers);
            }

            if(currentUser) { await addDoc(collection(db, "history"), { uid: currentUser.uid, email: currentUser.email, numbers: currentNumbers, mode: currentMode, isTest: isTestMode, createdAt: serverTimestamp() }); }
            showScreen('screen-result');
            playSound('win'); // SOM DE VIT√ìRIA NO FINAL
        }

        function renderBalls(numbers) {
            const grid = document.getElementById('numbersGrid');
            numbers.forEach((n, i) => {
                const div = document.createElement('div'); div.className = 'ball'; div.innerText = n<10?'0'+n:n;
                div.style.animationDelay = (i * 0.05) + 's'; setTimeout(() => div.classList.add('reveal'), 50); grid.appendChild(div);
            });
        }

        window.openVipLink = () => { if(isTestMode) return alert("Modo Teste"); window.open("https://pay.kiwify.com.br/MuUU7j8", "_blank"); }
        window.closeModal = () => { document.getElementById('paywallModal').style.display = 'none'; }
        window.resetApp = () => { playSound('click'); showScreen('screen-ritual'); }
        function showScreen(id) { document.querySelectorAll('.screen').forEach(s => s.classList.remove('active')); document.getElementById(id).classList.add('active'); }
        lucide.createIcons();
    </script>
</body>
</html>
